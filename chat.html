<!DOCTYPE html>
<html>
	<head>
		<title>Chat</title>
		<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
		<style>
body {
	font-family: monospace;
}
.container {
	border: 2px solid #dedede;
	background-color: #f1f1f1;
	border-radius: 5px;
	margin: 5px 0;
}
.darker {
	border-color: #ccc;
	background-color: #ddd;
}
.time {
	color: #666;
	margin-right: 5px;
}
#message, #send {
	position: fixed;
	bottom: 1em;
}
#message {
	width: 90%;
	height: 5%;
}
#send {
	width: 8%;
	height: calc(5% + 6px);
	right: 5px;
}
		</style>
	</head>
	<body>
		My ID: <span id="myID"></span><br>
		<span id="numConnected">0</span> Connected: <span id="listConnected"></span><button id="addConnected">+</button>
		<div id="messages">
			<!-- <div class="container">
				<span class="username">Some Guy</span><br>
				<span class="time">04:20am</span><span class="message">Some message</span>
			</div>
			<div class="container darker">
				<span class="username">Another Guy</span>
				<br><span class="time">11:03am</span><span class="message">My message</span>
				<br><span class="time">11:04am</span><span class="message">Another message in a row!</span>
			</div>
			<div class="container">
				<span class="username">Some Guy</span><br>
				<span class="time">11:59am</span><span class="message">Wow that</span><br>
				<span class="time">12:59pm</span><span class="message">is so</span><br>
				<span class="time">01:59pm</span><span class="message">cool!!</span><br>
			</div> -->
		</div>
		<div id="input">
			<textarea id="message"></textarea>
			<button id="send">Send</button>
		</div>
		<script>
			var myID = document.getElementById('myID');
			var numConnected = document.getElementById('numConnected');
			var connected = [];
			var addConnected = document.getElementById('addConnected');
			var messages = document.getElementById('messages');
			var message = document.getElementById('message');
			var peer = new Peer();
			peer.on('open', function(id) {
				myID.innerText = peer.id;
			});
			peer.on('connection', function(dataConnection) {
				connected.push(dataConnection.peer);
				numConnected.innerText = connected.length;
				listConnected.innerText = connected.join();
				dataConnection.on('data', function(data) {
					addMessage(data, peer.id);
					console.log(data);
				});
				dataConnection.on('disconnect', function() {
					
				});
			});
			function addMessage (msg, id) {
				var message = document.createElement('div');
				message.classList.add('container');
				var time = new Date().toLocaleTimeString();
				message.innerHTML = `<span class="id">${id}</span><br><span class="time">${time}</span><span class="msg">${msg}</span>`
				messages.appendChild(message);
			}
			addConnected.addEventListener('click', function () {
				peer.connect(prompt('New ID:'));
			 });
		</script>
	</body>
</html>
